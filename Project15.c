#include "connect_user.h"/*Prototipos de funciones*/int open_socket();int bind_to_port(int, int);void *connection_handler(void *);int main(int argc, char *argv[]){	const int PORT = 7200;	int connect;	int listener = open_socket();	if(listener == -1){		printf("Error en listener \n");		return 1;	}	//puts("Socket created");	if(bind_to_port(listener, PORT)==-1)		return 1;		if(listen(listener,10) == -1){		printf("No se puede conectar nadie mas \n");		return 1;	}	printf("Enlazando al puerto\n");	printf("Esperando al cliente\n");		pthread_t thread_id;		struct sockaddr_in client;	unsigned int addres_size = sizeof(client);			socklen_t client_address_size = sizeof(client);	user_list = empty_user_list();    pthread_mutex_init(&user_list_mutex, NULL);			while((connect = accept(listener, (struct sockaddr*)&client, &addres_size))){		printf("Esperando al cliente\n");					//Reply to the client	char *message = "Hola Cliente\n";        write(connect , message , strlen(message));				if( pthread_create( &thread_id , NULL ,  connection_handler , (void*) &connect) < 0){            perror("Error no se puede crear el hilo");            return 1;        }        puts("Manejador asignado");				//char* msg = "hola";		//send(connect,msg,strlen(msg),0); /* Servidor envia un mensaje*/		//char server_reply[2000];		//recv(connect, server_reply , 2000 , 0); /*cliente responde y lo coloca en server_reply*/		//puts(server_reply); 	}		if(connect < 0){		printf("No se puede conectar socket secundario\n");		return 1;	}		return 0;	}/* This will handle connection for each client */void *connection_handler(void *this){    //Get the socket descriptor    int sock = *(int*)this;	int read_size;    char *message, client_message[2000];         //Send some messages to the client    message = "Soy el Manejador de conexion:: Yo me comunicare con usted\n";    write(sock , message , strlen(message));		message = "Ahora escriba algo \n";    write(sock , message , strlen(message));     	 //Receive a message from client    while( (read_size = recv(sock , client_message , 2000 , 0)) > 0 ){        //Enviar respuesta al cliente		message = "Su mensaje fue recibido, continue escribiendo algo\n";        write(sock , message , strlen(message));	//clear the message buffer	memset(client_message, 0, 2000);    }         if(read_size == 0){        puts("Cliente Desconectado");        fflush(stdout);    }    else if(read_size == -1){        perror("comunicacion fallida");    }          return 0;}/*Implementacion del socket*/int open_socket(){	int s = socket(PF_INET,SOCK_STREAM,0); /*PF_INET IP4, SOCK_STREAM connection oriented*/	if(s == -1)		printf("Error al abrir socket\n");	return s;}int bind_to_port(int socket, int port){	//Prepare the sockaddr_in structure	struct sockaddr_in server;  	server.sin_family	= PF_INET;	server.sin_port = (in_port_t)htons(port);	server.sin_addr.s_addr = htonl(INADDR_ANY);		/*Avoid probles reusing the port*/	int reuse = 1;	if(setsockopt(socket,SOL_SOCKET,SO_REUSEADDR,(char*)&reuse,sizeof(int))==-1){		error("No es posible reusar el sockets\n");		return -1;	}	/* bind() elegirá un puerto aleatoriamente */    if( bind(socket,(struct sockaddr *)&server , sizeof(server)) < 0){		perror("No se puede enlazar al puerto : direccion ya esta en uso \n");		return -1;	}    //puts("bind done");	return 0;}